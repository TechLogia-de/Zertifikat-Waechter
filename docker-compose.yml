version: '3.8'

services:
  # Agent für Intranet-Scans
  agent:
    build: ./agent
    container_name: certwatcher-agent
    environment:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      SCAN_TARGETS: ${SCAN_TARGETS:-localhost}
      SCAN_PORTS: ${SCAN_PORTS:-443,8443,636}
      SCAN_INTERVAL: ${SCAN_INTERVAL:-3600}
      SCAN_TIMEOUT: ${SCAN_TIMEOUT:-5}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    restart: unless-stopped
    networks:
      - certwatcher

  # Worker (optional) für komplexe Jobs
  worker:
    build: ./worker
    container_name: certwatcher-worker
    environment:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      WORKER_INTERVAL: ${WORKER_INTERVAL:-300}
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASSWORD: ${SMTP_PASSWORD}
      SMTP_FROM: ${SMTP_FROM}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    restart: unless-stopped
    networks:
      - certwatcher

networks:
  certwatcher:
    driver: bridge


